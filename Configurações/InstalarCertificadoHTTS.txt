OBS se precisar copiar arquivo da instância para sua máquina usar->
 scp -i OpenWebTravel.pem ec2-user@100.30.111.136:/home/ec2-user/certificados/server.csr /Flytura/certificados
    
0) Gerar o arquivo server.key e server.csr
   
    openssl req -new -newkey rsa:2048 -nodes -keyout server.key -out server.csr \
    -subj "/C=BR/ST=MG/L=Belo Horizonte/O=Flytura Solucoes e Servicos LTDA/OU=TI/emailAddress=joao@flytura.com" \
    -addext "subjectAltName=IP:100.30.111.136,IP:54.156.244.197" GUARDE ESSES ARQUIVOS É MUITO IMPORTANTE

0.1) Abra o arquivo server.csr e copie seu conteudo
0.1.1) cole o conteudo na certificadora no campo 
        -----BEGIN CERTIFICATE REQUEST-----
        ...conteúdo...
        -----END CERTIFICATE REQUEST-----
0.1.2) Agora espera a certificadora emitir o certificado e siga os passos abaixo. 
0.1.3) A certificadora vai emitir dois arquivo um é o .crt e o outro o .pem



Certificado Configurar 

1) caso não tenha criar uma pasta em ->
        sudo mkdir -p /etc/nginx/ssl

2) copias os arquivos abaixo para a pasta
        sudo cp /home/ec2-user/certificados/server.key /etc/nginx/ssl/
        sudo cp /home/ec2-user/certificados/crt_code.crt /etc/nginx/ssl/
        sudo cp /home/ec2-user/certificados/ca_code.pem /etc/nginx/ssl/

3) Juntas os arquivo em fullchain.pem
        cat /etc/nginx/ssl/crt_code.crt /etc/nginx/ssl/ca_code.pem | sudo tee /etc/nginx/ssl/fullchain.pem

4) Dar permissões
        sudo chown root:nginx /etc/nginx/ssl/*
        sudo chmod 644 /etc/nginx/ssl/fullchain.pem
        sudo chmod 640 /etc/nginx/ssl/server.key


5) Editar o arquivo https.conf
        sudo nano /etc/nginx/conf.d/https.conf

******************ABAIXO HTTPS ***************************************
server {
    listen 443 ssl http2;
    server_name 100.30.111.136;

    ssl_certificate     /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    root /usr/share/nginx/html;
    index index.html;

    # API Go primeiro, para não ser "engolida" pelo SPA
    location ^~ /api/ {
        # Se seu app Go espera /api/... (mantém prefixo):
        proxy_pass http://127.0.0.1:8080;

        # Se seu app Go espera sem /api (strip prefix), use:
        # proxy_pass http://127.0.0.1:8080/;

        proxy_http_version 1.1;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_redirect off;
    }

    # Angular SPA
    location / {
        try_files $uri $uri/ /index.html;
    }
}


sudo nginx -t
sudo systemctl restart nginx


******************ABAIXO HTTP E HTTPS ***************************************


# HTTP (porta 80)
server {
    listen 80;
    server_name 100.30.111.136;

    root /usr/share/nginx/html;
    index index.html;

    # API Go primeiro, para não ser "engolida" pelo SPA
    location ^~ /api/ {
        # Se seu app Go espera /api/... (mantém prefixo):
        proxy_pass http://127.0.0.1:8080;

        # Se seu app Go espera sem /api (strip prefix), use:
        # proxy_pass http://127.0.0.1:8080/;

        proxy_http_version 1.1;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto http; # HTTP aqui
        proxy_redirect off;
    }

    # Angular SPA
    location / {
        try_files $uri $uri/ /index.html;
    }
}

# HTTPS (porta 443)
server {
    listen 443 ssl http2;
    server_name 100.30.111.136;

    ssl_certificate     /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    root /usr/share/nginx/html;
    index index.html;

    # API Go primeiro
    location ^~ /api/ {
        proxy_pass http://127.0.0.1:8080;

        # Se seu app Go espera sem /api:
        # proxy_pass http://127.0.0.1:8080/;

        proxy_http_version 1.1;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https; # HTTPS aqui
        proxy_redirect off;
    }

    # Angular SPA
    location / {
        try_files $uri $uri/ /index.html;
    }

    # (Opcional) HSTS
    # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
}

sudo nginx -t
sudo systemctl restart nginx